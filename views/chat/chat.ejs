<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Room</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>
<body>
  <%- include('../partials/navbar') %>

  <div class="container">
    <h5>Chat with <%= partnerName %></h5>
    <div class="card">
      <div class="card-content" id="chat-box" style="max-height: 300px; overflow-y: auto;">
        <% trade.messages.forEach(msg => { %>
          <div class="message <%= msg.sender._id.toString() === user._id.toString() ? 'right-align' : '' %>">
            <p><strong><%= msg.sender.firstName %>:</strong> <%= msg.content %></p>
          </div>
        <% }) %>
      </div>
    </div>

    <form id="messageForm" action="/trades/<%= trade._id %>/messages" method="POST">
      <div class="input-field">
        <textarea id="messageInput" name="content" class="materialize-textarea" required></textarea>
        <label for="messageInput">Type your message</label>
      </div>
      <button class="btn waves-effect" type="submit">Send</button>
    </form>
  </div>

  <script src="/js/chat.js"></script>
</body>
</html>
